<!DOCTYPE html> 
<html> 
<head> 
  <meta charset="utf-8"> 
  <title>Example App</title> 
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/grantstyle.css">
  <link rel="stylesheet" type="text/css" href="css/style.css" /> 
  <script>
  	if (!String.prototype.format) {
	  String.prototype.format = function() {
	    var args = arguments;
	    return this.replace(/{(\d+)}/g, function(match, number) { 
	      return typeof args[number] != 'undefined'
	        ? args[number]
	        : match
	      ;
	    });
	  };
	}
  </script>
</head> 
  <body> 
  	<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
    			<span class="sr-only">Toggle navigation</span>
    			<span class="icon-bar"></span>
    			<span class="icon-bar"></span>
    			<span class="icon-bar"></span>
  			</button>
  			<a class="navbar-brand" href="#">
  				<img style="max-width:100px; margin-top:-15px;"
  				src="img/dog-icon.png" />
  			</a>
		</div>
		
	</div>
</nav>

	<div id="demo"><h1>Text</h1></div>
	<script src="http://localhost:8081/socket.io/socket.io.js"></script>
	<script async src="https://www.youtube.com/iframe_api"></script>
	<script> 

		var animal_data = null;

		function render_page(animal_data) {
		    document.getElementById("body").innerHTML = makeCellList(animal_data);
		    muteVideos()
		}

		function update_page(animal_data) {
			return 
		}

		var socket = io.connect("localhost:8081");
		socket.on("death_stuff", function(death_stuff) { 
			if (!animal_data) {
				animal_data = death_stuff.animal_data
				render_page(animal_data)
				muteVideos(animal_data)
			} else {
				update_page(death_stuff.animal_data);
			}
		});

		function muteVideos(animal_data) {
			for (i in animal_data) {
				animal = animal_data[i]
				document.getElementById("video{0}".format(animal.id)).mute();
			}
		}


		function get_document_height() {
			var body = document.body,
    			html = document.documentElement;
			return Math.max( body.scrollHeight, body.offsetHeight, 
                       html.clientHeight, html.scrollHeight, html.offsetHeight );
		}


		function get_document_width() {
			var body = document.body,
    			html = document.documentElement;
			return Math.max( body.scrollWidth, body.offsetWidth, 
                       html.scrollWidth, html.offsetWidth );
		}

		function get_position_for_rank(rank) {
			const h = get_document_height()
			const w = get_document_width()
			return [w * (rank % 2), h * Math.floor(rank/2)]
			//position from: left, top 
		}


		function makeCellList(animals) {
			video_divs = animals.map((animal) => 
				'<div class="noclick">{0}</div></div>'.format(makeVideoCell(animal))
			)

			let video_html = '<div class="animal_cells">'
			for (i in video_divs) {
				video_html += video_divs[i];
			}
			video_html += '</div>'
			return video_html
		}


		function makeVideoCell(animal) {
			return '<iframe id='{0}' src="//giphy.com/embed/{1}" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>'.format(animal.id, animal.video_id)
		}


	</script> 

<div id="video_frame" class="col-md-6">	
	<iframe width="100%" 			height="100%" 			src="https://www.youtube.com/embed/kfchvCyHmsc?loop=1&rel=0&version=3&autoplay=1&controls=0&showinfo=0&playlist=kfchvCyHmsc" 			frameborder="0"> 		</iframe>
	<h2 id="name"><span>Fido</span></h2>
	<h2 id="clock"><span>01:34:52</span></h2>
	<h2 id="money"><span>$ <input type="text" name="dollars" id="dollars" value=" "> = <input readonly="readonly" name="time" id="time" value=" "> Minutes</span><button type="button" class="btn btn-danger" style="margin-left:5%;">Donate</button></h2>
	
</div>	

<div id="video_frame2" class="col-md-6">	
	<iframe width="100%" 			height="100%" 			src="https://www.youtube.com/embed/8ZSAurNw4yA?loop=1&rel=0&version=3&autoplay=1&controls=0&showinfo=0&playlist=kfchvCyHmsc" 			frameborder="0"> 		</iframe>
	<h2 id="name"><span>Kevin</span></h2>
	<h2 id="clock"><span>02:11:11</span></h2>
	<h2 id="money"><span>$ <input type="text" name="dollars" id="dollars" value=" "> = <input type="text" name="time" id="time" value=" "> Minutes</span><button type="button" class="btn btn-danger" style="margin-left:5%;">Donate</button></h2>
</div>	
    {{{body}}}
  </body>
</html>